CREATE PROCEDURE [dbo].[V4MVC_A054_MOTIVOFINIQUITO_SELECT_CERTIFICACION]
(@RUT		NVARCHAR(10) = NULL
,@ID_DOC	INT = NULL
,@DIVCOD	NVARCHAR(50) = NULL
,@IDEMPRESA	NVARCHAR(10) = NULL)AS
BEGIN

	SELECT MF.MOTIVO , MF.GLOSA , MF.ACTIVO , CASE WHEN WF.MOTIVO IS NOT NULL THEN 'true' ELSE 'false' END AS CHECKED 
	FROM A054_MOTIVOFINIQUITO AS MF
	LEFT JOIN (SELECT WMF.MOTIVO FROM WORKERS_MOTIVOFINIQUITO AS WMF 
				INNER JOIN ( 
				SELECT TOP 1 RUT, EMPRESA, ID FROM DOCS_WORKERS DW 
				WHERE DW.RUT = @RUT AND DW.EMPRESA = @IDEMPRESA AND DW.ID_DOC = @ID_DOC AND DW.DIVISION = @DIVCOD
				ORDER BY ID_DOCS_WORKERS DESC) DW2 ON WMF.RUT = DW2.RUT AND WMF.EMPRESA = DW2.EMPRESA AND WMF.IDARCHIVO = DW2.ID) WF ON MF.MOTIVO = WF.MOTIVO
	WHERE MF.ACTIVO = 'SI'

END
