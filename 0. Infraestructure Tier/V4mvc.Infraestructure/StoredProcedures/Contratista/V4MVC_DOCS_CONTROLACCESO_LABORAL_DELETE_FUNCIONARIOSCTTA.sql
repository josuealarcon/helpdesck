CREATE PROCEDURE [dbo].[V4MVC_DOCS_CONTROLACCESO_LABORAL_DELETE_FUNCIONARIOSCTTA]
(@ID int = NULL
,@ID_DISPUTA int = NULL
,@USUARIO nvarchar(10)= NULL) AS 
BEGIN

INSERT INTO DOCS_CONTROLACCESO_LABORAL_LOG (ID, ID_DOC, RUT, EMPRESA, NOMBRE_ARCHIVO, TIPO_CONTENIDO, FECHASUBE, HORASUBE, USUARIO, VALIDADO, CERTUSUARIO, CERTFECHA, CERTHORA, IDRECHAZO, OBSCERTIFICACION, ID_ARCHIVO, FECHA_INI, FECHA_FIN, CANTDIAS, USUARIODEL  ,FECHADEL                ,HORADEL)
									SELECT  ID, ID_DOC, RUT, EMPRESA, NOMBRE_ARCHIVO, TIPO_CONTENIDO, FECHASUBE, HORASUBE, USUARIO, VALIDADO, CERTUSUARIO, CERTFECHA, CERTHORA, IDRECHAZO, OBSCERTIFICACION, ID_ARCHIVO, FECHA_INI, FECHA_FIN, CANTDIAS, @USUARIO    ,[dbo].[hoy](GETDATE())  ,[dbo].[ahora](GETDATE()) 
									FROM  DOCS_CONTROLACCESO_LABORAL 
									WHERE ID =@ID

IF @ID_DISPUTA <> 0
BEGIN 
INSERT INTO DOCS_CONTROLACCESO_LABORAL_DISPUTA_LOG (ID_DISPUTA , ID_DOC , RUT , FECHA_INI , FECHA_FIN , PERIODO , EMPRESA , ID , USUARIO , FECHA , HORA , OBSERVACION , CERTUSUARIO ,  CERTFECHA , CERTHORA , VALIDADO , ESTADO , REVALUSUARIO , REVALFECHA , REVALHORA , OBSERVACION_REVAL, USRMOD      , FECHAMOD               , HORAMOD                   , ACCION )
										 SELECT     ID_DISPUTA , ID_DOC , RUT , FECHA_INI , FECHA_FIN , PERIODO , EMPRESA , ID , USUARIO , FECHA , HORA , OBSERVACION , CERTUSUARIO ,  CERTFECHA , CERTHORA , VALIDADO , ESTADO , REVALUSUARIO , REVALFECHA , REVALHORA , OBSERVACION_REVAL, @USUARIO    ,[dbo].[hoy](GETDATE())  ,[dbo].[ahora](GETDATE())   ,'ELIMINADO'  
										 FROM DOCS_CONTROLACCESO_LABORAL_DISPUTA
										 WHERE ID_DISPUTA = @ID_DISPUTA AND ESTADO = 'NO'

DELETE DOCS_CONTROLACCESO_LABORAL_DISPUTA WHERE ID_DISPUTA = @ID_DISPUTA AND ESTADO = 'NO' 
END

DELETE DOCS_CONTROLACCESO_LABORAL WHERE ID = @ID
END

