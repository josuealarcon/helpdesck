CREATE PROCEDURE [dbo].[V4MVC_A056_FORM30_UPDATE_CONTROLLABORAL_CTTA]
(
  @PERIODO			NVARCHAR(6)
 ,@IDEMPRESA		NVARCHAR(10)
 ,@INSPECCION		NVARCHAR(4)
 ,@ANIO				INT
 ,@ID_CERTIFICADO	INT
 ,@CERTIFICADO		BIGINT
 ,@USUARIO			NVARCHAR(10)
 ,@CLAVE			NVARCHAR(30)
 ,@REGION			NVARCHAR(3)
 ,@VIGENCIA			NVARCHAR(8)
 ,@MULT_NEJ			INT
 ,@MULT_EJ			INT
 ,@SANC_6M			INT
 ,@SANC_12M			INT
 ,@DP_NRO			INT
 ,@DP_MTO_UTM		FLOAT
 ,@DP_MTO_PESO		INT
 ,@RM_NRO			INT
 ,@RM_MTO_PESO		INT
 ,@VALIDADO			NVARCHAR(2)
 ,@RET_CODE			INT OUTPUT
) AS
BEGIN
	DECLARE @CURR_FECHA NVARCHAR(8) = convert(NVARCHAR(8), getdate(), 112) /* yyyymmdd */
	DECLARE @CURR_TIEMPOFULL NVARCHAR(8) = convert(NVARCHAR(8), getdate(), 108) /* hh:mm:ss */
	
	SET @RET_CODE = -1

	IF(NOT EXISTS(
			SELECT
				*
			FROM A056_FORM30
			WHERE
				EMPRESA = @IDEMPRESA AND
				REGION = @REGION AND
				INSPECCION = @INSPECCION AND
				ANIO = @ANIO AND
				CERTIFICADO = @CERTIFICADO
	))
		BEGIN
			SET @RET_CODE = 2  /*ERROR LOGICO; NO EXISTE*/
			RETURN
		END
	UPDATE A056_FORM30
	SET
		REGION = @REGION,
		INSPECCION = @INSPECCION,
		ANIO = @ANIO,
		CERTIFICADO = @CERTIFICADO,
		CLAVE = @CLAVE,
		VIGENCIA = @VIGENCIA,
		MULT_NEJ = @MULT_NEJ,
		MULT_EJ = @MULT_EJ,
		SANC_6M = @SANC_6M,
		SANC_12M = @SANC_12M,
		DP_NRO = @DP_NRO,
		DP_MTO_UTM = @DP_MTO_UTM,
		DP_MTO_PESO = @DP_MTO_PESO,
		RM_NRO = @RM_NRO,
		RM_MTO_PESO = @RM_MTO_PESO,
		FECHAMOD = @CURR_FECHA,
		HORAMOD = @CURR_TIEMPOFULL,
		QUIEN = @USUARIO,
		VALIDADO = IIF(@VALIDADO = '', 'NO', @VALIDADO),
		PERIODO = @PERIODO
	WHERE
		ID_CERTIFICADO = @ID_CERTIFICADO
END
