CREATE PROCEDURE [dbo].[V4MVC_DOCS_CONTROLACCESO_LABORAL_SELECT_DISPUTA]
(@RUT			NVARCHAR(10)= NULL
,@FECHA_INI		NVARCHAR(8)= NULL
,@FECHA_FIN	    NVARCHAR(8)= NULL
,@ID_DOC	    int= NULL
,@ID_DISPUTA	INT = NULL) AS
BEGIN
	IF @ID_DISPUTA <= 0
		BEGIN
			SELECT L.RUT, L.FECHA_INI, L.FECHA_FIN, W.NOMBRES, W.APELLIDOS, D.NOMBRE, L.VALIDADO, L.ID_ARCHIVO,DCLC.ESTADO, DCLC.OBSERVACION, DCLC.OBSERVACION_REVAL, DCLC.EMPRESA
			FROM DOCS_CONTROLACCESO_LABORAL L INNER JOIN WORKERS W ON W.RUT = L.RUT 
											  INNER JOIN DOCS D ON D.ID_DOC = L.ID_DOC  
											  LEFT JOIN DOCS_CONTROLACCESO_LABORAL_DISPUTA DCLC ON DCLC.ID = L.ID_ARCHIVO AND  DCLC.RUT = L.RUT AND DCLC.ID_DOC = L.ID_DOC
			WHERE L.RUT = @RUT AND L.FECHA_INI = @FECHA_INI AND L.FECHA_FIN = @FECHA_FIN AND L.ID_DOC = @ID_DOC
		END
	ELSE
		BEGIN
			SELECT L.RUT, L.FECHA_INI, L.FECHA_FIN, W.NOMBRES, W.APELLIDOS, D.NOMBRE, L.VALIDADO, L.ID_ARCHIVO,DCLC.ESTADO, DCLC.OBSERVACION, DCLC.OBSERVACION_REVAL, DCLC.EMPRESA 
			FROM DOCS_CONTROLACCESO_LABORAL L INNER JOIN WORKERS W ON W.RUT = L.RUT 
											  INNER JOIN DOCS D ON D.ID_DOC = L.ID_DOC 
											  LEFT JOIN DOCS_CONTROLACCESO_LABORAL_DISPUTA DCLC ON DCLC.ID = L.ID_ARCHIVO AND DCLC.RUT = L.RUT AND DCLC.ID_DOC = L.ID_DOC 
	       WHERE DCLC.ID_DISPUTA = @ID_DISPUTA
		END

END
