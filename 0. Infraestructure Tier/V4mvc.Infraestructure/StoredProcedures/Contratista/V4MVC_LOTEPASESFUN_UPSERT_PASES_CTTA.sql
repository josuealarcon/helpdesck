CREATE PROCEDURE [dbo].[V4MVC_LOTEPASESFUN_UPSERT_PASES_CTTA]
( 
  @PASE_ID			INT
 ,@RUT_FUNC			NVARCHAR(10)
 ,@IDEMPRESA        NVARCHAR(10)
 ,@TIPO_PASE		NVARCHAR(9) = ''
 ,@NOMBRES			NVARCHAR(50)
 ,@APELLIDOS		NVARCHAR(50)
 ,@HOTEL			BIT = 0
 ,@ALIMENTACION		BIT = 0
 ,@CONDUCE			BIT = 0
 ,@OST				NVARCHAR(14) = ''
 ,@SEXO				NVARCHAR(15)
 ,@FEC_NAC			NVARCHAR(8) = ''
 ,@ID_CATEGORIA		INT
 ,@ID_SUBCATEGORIA	INT
) AS 
BEGIN
	IF(
		(
			SELECT
				COUNT(*) 
			FROM LOTEPASESFUN
			WHERE
				NLOTEPROC = @PASE_ID AND
				RUTLOTE = @RUT_FUNC AND
				TIPORUT = 'FUNCIONARIO'
		) > 0
	  )
		BEGIN
			UPDATE LOTEPASESFUN 
			SET
				ALOJAMIENTOLT = IIF(@HOTEL = 1, 'SI', 'NO'),
				CASINOLT = IIF(@ALIMENTACION = 1, 'SI', 'NO'),
				LICONDLT = IIF(@CONDUCE = 1, 'SI', 'NO'),
				SEXOLT = @SEXO,
				FNACIMLT = @FEC_NAC,
				CODCATEGORIA = @ID_CATEGORIA,
				CODSUBCATEGORIA = @ID_SUBCATEGORIA
			WHERE
				NLOTEPROC = @PASE_ID AND
				RUTLOTE = @RUT_FUNC AND
				TIPORUT = 'FUNCIONARIO'
		END
	ELSE
		BEGIN
			INSERT LOTEPASESFUN
					(
					 NLOTEPROC,
					 RUTLOTE,
					 EMPRESALT,
					 TIPORUT,
					 SINOLT,
					 APELLIDOSLT,
					 NOMBRESLT,
					 TIPOLT,
					 ALOJAMIENTOLT,
					 CASINOLT,
					 LICONDLT,
					 OSTLT,
					 SEXOLT,
					 FNACIMLT,
					 CODCATEGORIA,
					 CODSUBCATEGORIA)
			VALUES
					(
					 @PASE_ID,
					 @RUT_FUNC,
					 @IDEMPRESA,
					 'FUNCIONARIO',
					 'SI',
					 @APELLIDOS,
					 @NOMBRES,
					 @TIPO_PASE,
					 IIF(@HOTEL = 1, 'SI', 'NO'),
					 IIF(@ALIMENTACION = 1, 'SI', 'NO'),
					 IIF(@CONDUCE = 1, 'SI', 'NO'),
					 @OST,
					 @SEXO,
					 @FEC_NAC,
					 @ID_CATEGORIA,
					 @ID_SUBCATEGORIA
					)
		END

END


