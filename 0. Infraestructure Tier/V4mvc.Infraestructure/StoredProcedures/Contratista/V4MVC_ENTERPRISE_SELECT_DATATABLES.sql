CREATE PROCEDURE [dbo].[V4MVC_ENTERPRISE_SELECT_DATATABLES]              
(           
@IDISPLAYSTART INT,            
@IDISPLAYLENGTH INT,            
@SEARCH_IDEMPRESA NVARCHAR(11) = NULL,  
@SEARCH_ACRONIMO NVARCHAR(50) = NULL,  
@SEARCH_NOMBRE NVARCHAR(50) = NULL,  
@SORT_COLUMN NVARCHAR(4) = NULL,  
@SORT_DIRECTION NVARCHAR(4) = NULL  
) AS              
BEGIN          
          
IF ISNULL(@SEARCH_IDEMPRESA,'') != '' OR ISNULL(@SEARCH_ACRONIMO,'') != '' OR ISNULL(@SEARCH_NOMBRE,'') != ''  
BEGIN          
             
 IF ISNULL(@SEARCH_IDEMPRESA,'') != '' AND ISNULL(@SEARCH_ACRONIMO,'') = '' AND ISNULL(@SEARCH_NOMBRE,'') = ''  
 BEGIN  
	IF @SORT_DIRECTION = 'ASC'
	BEGIN
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                         
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')  
		AND IDEMPRESA LIKE '%' + @SEARCH_IDEMPRESA + '%'  
		ORDER BY
			CASE WHEN @SORT_COLUMN='0' THEN IDEMPRESA END ASC,
			CASE WHEN @SORT_COLUMN='1' THEN ACRONIMO END ASC,
			CASE WHEN @SORT_COLUMN='2' THEN NOMBRE END ASC
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY   
	END

	IF @SORT_DIRECTION = 'DESC'
	BEGIN
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                         
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')  
		AND IDEMPRESA LIKE '%' + @SEARCH_IDEMPRESA + '%'  
		ORDER BY
			CASE WHEN @SORT_COLUMN='0' THEN IDEMPRESA END DESC,
			CASE WHEN @SORT_COLUMN='1' THEN ACRONIMO END DESC,
			CASE WHEN @SORT_COLUMN='2' THEN NOMBRE END DESC
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY  
	END
 END  
  
 IF ISNULL(@SEARCH_IDEMPRESA,'') = '' AND ISNULL(@SEARCH_ACRONIMO,'') != '' AND ISNULL(@SEARCH_NOMBRE,'') = ''  
 BEGIN  

	IF @SORT_DIRECTION = 'ASC'
	BEGIN
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                         
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')  
		AND ACRONIMO LIKE '%' + @SEARCH_ACRONIMO + '%'  
		ORDER BY
			CASE WHEN @SORT_COLUMN='0' THEN IDEMPRESA END ASC,
			CASE WHEN @SORT_COLUMN='1' THEN ACRONIMO END ASC,
			CASE WHEN @SORT_COLUMN='2' THEN NOMBRE END ASC
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY  
	END

	IF @SORT_DIRECTION = 'DESC'
	BEGIN
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                         
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')  
		AND ACRONIMO LIKE '%' + @SEARCH_ACRONIMO + '%'  
		ORDER BY
			CASE WHEN @SORT_COLUMN='0' THEN IDEMPRESA END DESC,
			CASE WHEN @SORT_COLUMN='1' THEN ACRONIMO END DESC,
			CASE WHEN @SORT_COLUMN='2' THEN NOMBRE END DESC 
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY  
	END 
 END  
  
 IF ISNULL(@SEARCH_IDEMPRESA,'') = '' AND ISNULL(@SEARCH_ACRONIMO,'') = '' AND ISNULL(@SEARCH_NOMBRE,'') != ''  
 BEGIN  

	IF @SORT_DIRECTION = 'ASC'
	BEGIN
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                         
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')  
		AND NOMBRE LIKE '%' + @SEARCH_NOMBRE + '%'  
		ORDER BY
			CASE WHEN @SORT_COLUMN='0' THEN IDEMPRESA END ASC,
			CASE WHEN @SORT_COLUMN='1' THEN ACRONIMO END ASC,
			CASE WHEN @SORT_COLUMN='2' THEN NOMBRE END ASC
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY  
	END

	IF @SORT_DIRECTION = 'DESC'
	BEGIN
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                         
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')  
		AND NOMBRE LIKE '%' + @SEARCH_NOMBRE + '%'  
		ORDER BY
			CASE WHEN @SORT_COLUMN='0' THEN IDEMPRESA END DESC,
			CASE WHEN @SORT_COLUMN='1' THEN ACRONIMO END DESC,
			CASE WHEN @SORT_COLUMN='2' THEN NOMBRE END DESC 
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY  
	END
 END  
  
 IF ISNULL(@SEARCH_IDEMPRESA,'') = '' AND ISNULL(@SEARCH_ACRONIMO,'') != '' AND ISNULL(@SEARCH_NOMBRE,'') != ''  
 BEGIN  

	IF @SORT_DIRECTION = 'ASC'
	BEGIN
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                         
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')  
		AND ACRONIMO LIKE '%' + @SEARCH_ACRONIMO + '%'  
		AND NOMBRE LIKE '%' + @SEARCH_NOMBRE + '%'  
		ORDER BY
			CASE WHEN @SORT_COLUMN='0' THEN IDEMPRESA END ASC,
			CASE WHEN @SORT_COLUMN='1' THEN ACRONIMO END ASC,
			CASE WHEN @SORT_COLUMN='2' THEN NOMBRE END ASC
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY 
	END

	IF @SORT_DIRECTION = 'DESC'
	BEGIN
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                         
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')  
		AND ACRONIMO LIKE '%' + @SEARCH_ACRONIMO + '%'  
		AND NOMBRE LIKE '%' + @SEARCH_NOMBRE + '%'  
		ORDER BY
			CASE WHEN @SORT_COLUMN='0' THEN IDEMPRESA END DESC,
			CASE WHEN @SORT_COLUMN='1' THEN ACRONIMO END DESC,
			CASE WHEN @SORT_COLUMN='2' THEN NOMBRE END DESC 
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY 
	END
 END  
  
 IF ISNULL(@SEARCH_IDEMPRESA,'') != '' AND ISNULL(@SEARCH_ACRONIMO,'') != '' AND ISNULL(@SEARCH_NOMBRE,'') != ''  
 BEGIN  

 	IF @SORT_DIRECTION = 'ASC'
	BEGIN
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                         
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')  
		AND IDEMPRESA LIKE '%' + @SEARCH_IDEMPRESA + '%'  
		AND ACRONIMO LIKE '%' + @SEARCH_ACRONIMO + '%'  
		AND NOMBRE LIKE '%' + @SEARCH_NOMBRE + '%'  
		ORDER BY
			CASE WHEN @SORT_COLUMN='0' THEN IDEMPRESA END ASC,
			CASE WHEN @SORT_COLUMN='1' THEN ACRONIMO END ASC,
			CASE WHEN @SORT_COLUMN='2' THEN NOMBRE END ASC 
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY 
	END

	IF @SORT_DIRECTION = 'DESC'
	BEGIN
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                         
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')  
		AND IDEMPRESA LIKE '%' + @SEARCH_IDEMPRESA + '%'  
		AND ACRONIMO LIKE '%' + @SEARCH_ACRONIMO + '%'  
		AND NOMBRE LIKE '%' + @SEARCH_NOMBRE + '%'  
		ORDER BY
			CASE WHEN @SORT_COLUMN='0' THEN IDEMPRESA END DESC,
			CASE WHEN @SORT_COLUMN='1' THEN ACRONIMO END DESC,
			CASE WHEN @SORT_COLUMN='2' THEN NOMBRE END DESC 
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY 
	END   
 END  
  
 IF ISNULL(@SEARCH_IDEMPRESA,'') != '' AND ISNULL(@SEARCH_ACRONIMO,'') != '' AND ISNULL(@SEARCH_NOMBRE,'') = ''  
 BEGIN  

	IF @SORT_DIRECTION = 'ASC'
	BEGIN
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                         
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')  
		AND IDEMPRESA LIKE '%' + @SEARCH_IDEMPRESA + '%'  
		AND ACRONIMO LIKE '%' + @SEARCH_ACRONIMO + '%'  
		ORDER BY
			CASE WHEN @SORT_COLUMN='0' THEN IDEMPRESA END ASC,
			CASE WHEN @SORT_COLUMN='1' THEN ACRONIMO END ASC,
			CASE WHEN @SORT_COLUMN='2' THEN NOMBRE END ASC 
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY 
	END

	IF @SORT_DIRECTION = 'DESC'
	BEGIN
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                         
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')  
		AND IDEMPRESA LIKE '%' + @SEARCH_IDEMPRESA + '%'  
		AND ACRONIMO LIKE '%' + @SEARCH_ACRONIMO + '%'  
		ORDER BY
			CASE WHEN @SORT_COLUMN='0' THEN IDEMPRESA END DESC,
			CASE WHEN @SORT_COLUMN='1' THEN ACRONIMO END DESC,
			CASE WHEN @SORT_COLUMN='2' THEN NOMBRE END DESC 
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY 
	END   
 END  
  
 IF ISNULL(@SEARCH_IDEMPRESA,'') != '' AND ISNULL(@SEARCH_ACRONIMO,'') = '' AND ISNULL(@SEARCH_NOMBRE,'') != ''  
 BEGIN  

	IF @SORT_DIRECTION = 'ASC'
	BEGIN
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                         
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')  
		AND IDEMPRESA LIKE '%' + @SEARCH_IDEMPRESA + '%'  
		AND NOMBRE LIKE '%' + @SEARCH_NOMBRE + '%'  
		ORDER BY
			CASE WHEN @SORT_COLUMN='0' THEN IDEMPRESA END ASC,
			CASE WHEN @SORT_COLUMN='1' THEN ACRONIMO END ASC,
			CASE WHEN @SORT_COLUMN='2' THEN NOMBRE END ASC 
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY   
	END

	IF @SORT_DIRECTION = 'DESC'
	BEGIN
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                         
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')  
		AND IDEMPRESA LIKE '%' + @SEARCH_IDEMPRESA + '%'  
		AND NOMBRE LIKE '%' + @SEARCH_NOMBRE + '%'  
		ORDER BY
			CASE WHEN @SORT_COLUMN='0' THEN IDEMPRESA END DESC,
			CASE WHEN @SORT_COLUMN='1' THEN ACRONIMO END DESC,
			CASE WHEN @SORT_COLUMN='2' THEN NOMBRE END DESC 
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY  
	END
 END  
          
END          
ELSE          
BEGIN          
   
	 IF @SORT_COLUMN='0' AND @SORT_DIRECTION='ASC'  
	 BEGIN  
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                           
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')          
		ORDER BY IDEMPRESA ASC          
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY     
	 END  
  
	 IF @SORT_COLUMN='0' AND @SORT_DIRECTION='DESC'  
	 BEGIN  
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                     
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')          
		ORDER BY IDEMPRESA DESC          
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY     
	 END  
  
	 IF @SORT_COLUMN='1' AND @SORT_DIRECTION='ASC'  
	 BEGIN  
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                           
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')          
		ORDER BY ACRONIMO ASC          
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY     
	 END  
  
	 IF @SORT_COLUMN='1' AND @SORT_DIRECTION='DESC'  
	 BEGIN  
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                           
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')          
		ORDER BY ACRONIMO DESC          
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY     
	 END  
  
	 IF @SORT_COLUMN='2' AND @SORT_DIRECTION='ASC'  
	 BEGIN  
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                           
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')          
		ORDER BY NOMBRE ASC          
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY     
	 END  
  
	 IF @SORT_COLUMN='2' AND @SORT_DIRECTION='DESC'  
	 BEGIN  
		SELECT  IDEMPRESA,  ACRONIMO,  NOMBRE                           
		FROM ENTERPRISE            
		WHERE (AUTOR='SI')          
		ORDER BY NOMBRE DESC          
		OFFSET @IDISPLAYSTART ROWS FETCH NEXT @IDISPLAYLENGTH ROWS ONLY     
	 END  
END              
          
END   
