CREATE PROCEDURE [dbo].[V4MVC_A203_BUS_PAS_SELECT_VIAJE_BUSESRESERVA_CTTA]
(@IDPROG NUMERIC(18,0) = NULL) AS
BEGIN

	SELECT DISTINCT B.IDPROG				, B.FECHA				, B.HORA				, B.PATENTE
				  , B.ORIGEN				, B.DESTINO				, B.MARCA				, B.MODELO
				  , B.TIPO					, B.RESERVAS			, B.ASIENTOS			, B.DESCRIPCION
	,CASE WHEN (CONVERT(VARCHAR(16), (FECHA+' '+HORA), 102) >= CONVERT(VARCHAR(16), DATEADD(hh, ISNULL(P.TIEMPO_CANCELA
	, 0),GETDATE()),120)) THEN 1 ELSE 0 END AS PERMITIDO
	, ISNULL(P.TIEMPO_CANCELA, 0) AS TIEMPO_CANCELA
	, CASE WHEN CONVERT(DATETIME,B.FECHA+' '+B.HORA, 121) > GETDATE() THEN 'NO' ELSE 'SI' END AS REALIZADO 
	FROM A203_BUS_PAS AS B 
	LEFT OUTER JOIN VIAJES_PARAMETROS P ON 1=1 
	WHERE (IDPROG = @IDPROG)

END
