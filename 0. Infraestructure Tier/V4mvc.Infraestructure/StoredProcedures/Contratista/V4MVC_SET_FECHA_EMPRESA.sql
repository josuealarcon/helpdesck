CREATE PROCEDURE [dbo].[V4MVC_SET_FECHA_EMPRESA]
(
@ID_DOC_FEC		INT
,@IDEMPRESA		NVARCHAR(10)
,@FECHA			NVARCHAR(8)
)
AS
BEGIN
	DECLARE @CURR_FECHA NVARCHAR(8) = convert(NVARCHAR(8), getdate(), 112) /* yyyymmdd */
	DECLARE @CURR_TIEMPOFULL NVARCHAR(8) = convert(NVARCHAR(8), getdate(), 108) /* hh:mm:ss */
	DECLARE @FEC NVARCHAR(8) = NULL
	
	IF(@FECHA = '19000101')
		BEGIN
			DELETE FROM DOCS_FEC_WORKERS WHERE (RUT = @IDEMPRESA) AND (ID_DOC_FEC = @ID_DOC_FEC)
		END
	ELSE
		BEGIN
			SELECT TOP 1 @FEC = FECHA FROM DOCS_FEC_WORKERS WHERE (RUT = @IDEMPRESA) AND (ID_DOC_FEC = @ID_DOC_FEC)
			IF(@FEC IS NULL)
				BEGIN
					INSERT INTO DOCS_FEC_WORKERS (RUT, ID_DOC_FEC, EMPRESA, DIVISION, FECHA, FECHAMOD, HORAMOD) VALUES (@IDEMPRESA, @ID_DOC_FEC, 'NO', 'NO', @FECHA, @CURR_FECHA, @CURR_TIEMPOFULL)
				END
			ELSE
				BEGIN
					UPDATE DOCS_FEC_WORKERS SET FECHA = @FECHA , FECHAMOD = @CURR_FECHA, HORAMOD = @CURR_TIEMPOFULL
					WHERE (RUT = @IDEMPRESA) AND (ID_DOC_FEC = @ID_DOC_FEC)
				END
		END
END
