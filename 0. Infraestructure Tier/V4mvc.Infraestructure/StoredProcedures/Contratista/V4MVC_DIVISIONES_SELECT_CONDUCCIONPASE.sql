CREATE PROCEDURE [dbo].[V4MVC_DIVISIONES_SELECT_CONDUCCIONPASE]
( @IDEMPRESA           NVARCHAR(10)
, @RUT				   NVARCHAR(10)	) AS
BEGIN

	SELECT D.DIVISION, D.DIVCOD, D.CTRL_CONDUCC , L.LOTENUM , @RUT AS RUT , D.PAIS
			, CASE WHEN [dbo].[fn_WL_Conductor] (@RUT,D.DIVCOD,dbo.hoy(getdate())) = 1 THEN 'true' ELSE 'false' END AS CERTCOND
	FROM A024_DIVISIONES AS D 
	LEFT JOIN (SELECT L.LOTENUM , L.DIVISION FROM LOTEPASES AS L 
				INNER JOIN LOTEPASESFUN AS LF ON L.LOTENUM = LF.NLOTEPROC 
				WHERE 
				(LF.RUTLOTE = @RUT) 
				AND (L.LOTEFINICIO <= DBO.HOY(GETDATE())) 
				AND (L.LOTEFFINAL >= DBO.HOY(GETDATE())) AND 
				LF.EMPRESALT = @IDEMPRESA AND 
				(LF.LICONDLT = 'SI')) AS L ON L.DIVISION = D.DIVCOD
	WHERE
	(ACTIVO = N'SI') 
	ORDER BY D.DIVISION

END

