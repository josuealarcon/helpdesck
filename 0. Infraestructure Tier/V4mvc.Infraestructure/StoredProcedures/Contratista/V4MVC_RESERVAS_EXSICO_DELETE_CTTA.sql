CREATE PROCEDURE [dbo].[V4MVC_RESERVAS_EXSICO_DELETE_CTTA]
(
 @USUARIO		NVARCHAR(10)
,@LIST_ID		NVARCHAR(250)
)
AS
BEGIN

	SELECT value AS ID_RESERVA INTO #TEMP_SPLIT_LIST_ID       
	FROM string_split(@LIST_ID,',')   

	SELECT  ROW_NUMBER() OVER(ORDER BY ID_RESERVA ASC) AS ID , * INTO #TEMP_SPLIT_B from                     
	#TEMP_SPLIT_LIST_ID      
	
	DECLARE @CONTADOR INT 
	DECLARE @MAXIMO INT 
	DECLARE @DATO VARCHAR(10) 

	SET @CONTADOR = 1    
	SELECT @MAXIMO = MAX(ID) FROM  #TEMP_SPLIT_B  

	WHILE ( @CONTADOR <= @MAXIMO )                     
	BEGIN        

		SELECT @DATO = ID_RESERVA FROM #TEMP_SPLIT_B                
		WHERE ID = @CONTADOR 

		SELECT				 EMPRESA							,RUT							,FECHARES			,HORAINICIO 
							,HORATERMINO						,TIPO							,ASISTIO			,MOTIVO 
							,FECHASOL							,HORASOL						,USUARIOSOL			,dbo.HOY(GETDATE()) AS FECHAMOD
							,dbo.AHORA(GETDATE()) AS HORAMOD	,@USUARIO AS USUARIOMOD			,'DEL' AS TIPOMOD
							INTO #TEMP
		FROM RESERVAS_EXSICO WHERE ID = @DATO

		INSERT INTO LOG_RESERVA_SICO (
										EMPRESA					,RUT							,FECHARES			,HORAINICIO 
									   ,HORATERMINO				,TIPO							,ASISTIO			,MOTIVO 
									   ,FECHASOL				,HORASOL						,USUARIOSOL			,FECHAMOD 
									   ,HORAMOD					,USUARIOMOD						,TIPOMOD
									 )
					SELECT				EMPRESA					,RUT							,FECHARES			,HORAINICIO 
									   ,HORATERMINO				,TIPO							,ASISTIO			,MOTIVO 
									   ,FECHASOL				,HORASOL						,USUARIOSOL			,FECHAMOD
									   ,HORAMOD					,USUARIOMOD						,TIPOMOD 
					FROM #TEMP

		DELETE FROM RESERVAS_EXSICO WHERE ID = @DATO

		DROP TABLE #TEMP

		SET @CONTADOR = @CONTADOR +1                     
	END  
END

