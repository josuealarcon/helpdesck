CREATE PROCEDURE [dbo].[V4MVC_DOCS_OST_PREVENCIONISTA_DELETE_CONTRATOST_CTTA]
(
  @NUM_SOLICITUD		INT
 ,@USUARIO				NVARCHAR(10)
) AS
BEGIN
	DECLARE @CURR_FECHA NVARCHAR(8) = convert(NVARCHAR(8), getdate(), 112) /* yyyymmdd */
	DECLARE @CURR_TIEMPOFULL NVARCHAR(8) = convert(NVARCHAR(8), getdate(), 108) /* hh:mm:ss */
	
	IF(EXISTS(
		(
			SELECT *
			FROM DOCS_OST_PREVENCIONISTA
			WHERE ID = @NUM_SOLICITUD
		)
	))
		BEGIN
			UPDATE DOCS_OST_PREVENCIONISTA
			SET
				RUT_PREVENCIONISTA = '',
				ID_ARCHIVO = NULL,
				USRSUBE = '',
				FECHASUBE = '',
				HORASUBE = '',
				USRMOD = @USUARIO,
				FECHAMOD = @CURR_FECHA,
				HORAMOD = @CURR_TIEMPOFULL
			WHERE ID = @NUM_SOLICITUD

			INSERT INTO DOCS_OST_PREVENCIONISTA_HIST
				(
				ID, OST, EMPRESA, DOTACION, USRCREACION, FECHACREACION,
				HORACREACION, APORTE_ANGLO, MOTIVO, RUT_PREVENCIONISTA, ID_ARCHIVO,
				ESTADO, USRSUBE, FECHASUBE, HORASUBE, CERTUSUARIO, CERTFECHA,
				CERTHORA, OBSERVACION, USRAPORTE, FECHAAPORTE, HORAAPORTE, USRMOD,
				FECHAMOD, HORAMOD)
			SELECT
				ID, OST, EMPRESA, DOTACION, USRCREACION, FECHACREACION,
				HORACREACION, APORTE_ANGLO, MOTIVO, RUT_PREVENCIONISTA,
				ID_ARCHIVO, ESTADO, USRSUBE, FECHASUBE, HORASUBE, CERTUSUARIO,
				CERTFECHA, CERTHORA, OBSERVACION, USRAPORTE, FECHAAPORTE, HORAAPORTE,
				USRMOD, FECHAMOD, HORAMOD
			FROM DOCS_OST_PREVENCIONISTA
			WHERE ID = @NUM_SOLICITUD 

		END
END

