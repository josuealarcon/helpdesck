
CREATE PROCEDURE [dbo].[V4MVC_APROBACION_SUBCONTRATOS_SELECT_ONE_CTTA]  
(@ID  INT = NULL)  
AS  
BEGIN  
	SELECT  AP.USR_SOLICITA, A.NOMBRE AS NOMBRE_ARCHIVO, AP.MADRE, AP.EMPRESA  
			,AP.OST, AP.NIVEL, AP.FINICIO, AP.FTERMINO  
			,AP.MONTO, AP.DOTACION, AP.DOTACION_VEHI, AP.ADMIN_CTTA 
			,AP.CORREO_ADM_CTTA, AP.TELEFONO, AP.ID_ARCHIVO, AP.LICITACION  
			,E.ACRONIMO
			,ISNULL(AP.ADM_VALIDA_ESTADO,'NO') AS ADM_VALIDA_ESTADO 
			,AP.ADM_VALIDA, AP.FEC_ADM_VALIDA, AP.HORA_ADM_VALIDA, AP.OBS_ADM_VALIDA 
			,ISNULL (W2.NOMBRES + ' '+  W2.APELLIDOS ,'-') AS  NOMBRES_ADM_VALIDA
				
			,ISNULL(ADM_SUPCHAIN_ESTADO,'NO') AS ADM_SUPCHAIN_ESTADO 
			,ADM_SUPCHAIN_VALIDA, FEC_SUPCHAIN_VALIDA, HORA_SUPCHAIN_VALIDA, OBS_SUPCHAIN_VALIDA 
			,ISNULL (W3.NOMBRES + ' '+ W3.APELLIDOS ,'-') AS  NOMBRES_ADM_SUPCHAIN_VALIDA
  
			,ISNULL(ADM_GSEGURIDAD_ESTADO,'NO') AS ADM_GSEGURIDAD_ESTADO 
			,ADM_GSEGURIDAD_VALIDA,FEC_GSEGURIDAD_VALIDA, HORA_GSEGURIDAD_VALIDA, OBS_GSEGURIDAD_VALIDA 
			,ISNULL (W4.NOMBRES + ' '+ W4.APELLIDOS ,'-') AS  NOMBRES_ADM_GSEGURIDAD_VALIDA

			,AP.ID,	W.NOMBRES AS NOMBRES_ADMIN_CTTA
			,W.APELLIDOS AS APELLIDOS_ADMIN_CTTA
  
	FROM APROBACION_SUBCONTRATOS AP INNER JOIN ARCHIVOS A ON A.ID=AP.ID_ARCHIVO 
	LEFT JOIN WORKERS AS W  ON W.RUT = AP.ADMIN_CTTA
	LEFT JOIN WORKERS AS W2 ON W2.RUT = AP.ADM_VALIDA
	LEFT JOIN WORKERS AS W3 ON W3.RUT = AP.ADM_SUPCHAIN_VALIDA
	LEFT JOIN WORKERS AS W4 ON W4.RUT = AP.ADM_GSEGURIDAD_VALIDA
	INNER JOIN ENTERPRISE AS E ON E.IDEMPRESA = AP.EMPRESA   
   WHERE AP.ID = @ID 
END  

