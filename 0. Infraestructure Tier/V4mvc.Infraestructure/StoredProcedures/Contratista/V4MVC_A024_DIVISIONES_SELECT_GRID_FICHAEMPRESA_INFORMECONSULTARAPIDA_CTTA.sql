CREATE PROCEDURE [dbo].[V4MVC_A024_DIVISIONES_SELECT_GRID_FICHAEMPRESA_INFORMECONSULTARAPIDA_CTTA]
(
  @EMPRESA NVARCHAR(20)
) AS 
BEGIN

SELECT  D.DIVISION
, D.DIVCOD 
,(SELECT COUNT (DISTINCT RUT) AS CUENTA FROM VW_WL_NOMINA WHERE EMPRESA = @EMPRESA AND DIVISION = D.DIVCOD) AS FUNCIONARIOS_NOMINA
,(SELECT COUNT (DISTINCT RUT) AS CUENTA FROM VW_WL_ACREDITADO WHERE EMPRESA = @EMPRESA AND DIVISION = D.DIVCOD ) AS FUNCIONARIOS_AUTORIZADOS
,(SELECT COUNT (PATENTE) AS CUENTA FROM TRANSPORT WHERE EMPRESA = @EMPRESA  AND AUTOR <> D.DIVCOD) AS VEHICULOS
,(SELECT COUNT(DISTINCT OSTARBOL.OST) AS CUENTA FROM OSTARBOL INNER JOIN OSTDIVLOCAL ON OSTARBOL.OST = OSTDIVLOCAL.OST 
  WHERE (OSTARBOL.EMPRESA = @EMPRESA) AND (OSTDIVLOCAL.DIVISION = D.DIVCOD) AND (dbo.hoy(getdate()) BETWEEN OSTARBOL.FINICIO AND OSTARBOL.FTERMINO)) AS CONTRATOS_ACTIVOS
FROM A024_DIVISIONES as D 
WHERE  D.ACTIVO = 'SI' 
ORDER BY D.DIVISION 

END
