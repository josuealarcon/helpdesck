CREATE PROCEDURE [dbo].[V4MVC_INFORME_CASINO_SERVICIO_CTTA]
(
 @FECHAINI		NVARCHAR(8)		= NULL
,@FECHAFIN		NVARCHAR(8)		= NULL
,@DIVCOD		NVARCHAR(4)		= NULL
,@EMPRESA		NVARCHAR(10)	= NULL
,@LOCALES		NVARCHAR(MAX)	= NULL
)

AS
BEGIN

	CREATE TABLE #LOCALES
	(
		LOCAL	NVARCHAR(50)  COLLATE DATABASE_DEFAULT NOT NULL
	)

	SELECT VALUE AS LOCAL INTO #TEMP_SPLIT_LOCALES
	FROM STRING_SPLIT(@LOCALES,',')

	SELECT DISTINCT(SERVICIO) FROM WC3_VISTA_CASINO
	WHERE EMPRESA = ISNULL(@EMPRESA,EMPRESA)
	AND FECHA BETWEEN ISNULL(@FECHAINI,FECHA) AND ISNULL(@FECHAFIN,FECHA)
	AND DIVISION = ISNULL(@DIVCOD,DIVISION)
	AND ISNULL(ERROR,'') = ''
	AND LOCAL IN (SELECT LOCAL FROM #TEMP_SPLIT_LOCALES)
	ORDER BY SERVICIO

END
