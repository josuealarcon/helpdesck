CREATE PROCEDURE [dbo].[V4MVC_TRANSPORT_UPDATE_VEHICULOS_CTTA]
(
  @RUT_PROPIETARIO	NVARCHAR(10)
 ,@ANOFAB			NVARCHAR(4) = ''
 ,@MODELO			NVARCHAR(50) = ''
 ,@MARCA			NVARCHAR(50) = ''
 ,@TIPO				INT = NULL
 ,@COLOR			NVARCHAR(30) = ''
 ,@TIPO_PROPIETARIO	NVARCHAR(1) = ''
 ,@PATENTE			NVARCHAR(8)
 ,@NOM_DUENO		NVARCHAR(50) = ''
 ,@APELLIDO_DUENO	NVARCHAR(50) = ''
 ,@ACRONIMO_DUENO	NVARCHAR(50) = ''
)
AS
BEGIN
	UPDATE TRANSPORT
	SET
		ANOFAB = @ANOFAB,
		MODELO = @MODELO,
		MARCA = @MARCA,
		TIPO = @TIPO,
		COLOR = @COLOR,
		RUT_PROPIETARIO = @RUT_PROPIETARIO,
		TIPO_PROPIETARIO = @TIPO_PROPIETARIO
	WHERE (PATENTE = @PATENTE)

	IF(@TIPO_PROPIETARIO = 'F')
		BEGIN
			IF(NOT EXISTS(
							SELECT
								NOMBRES
							FROM WORKERS
							WHERE RUT = @RUT_PROPIETARIO
						 )
			)
				BEGIN
					INSERT INTO WORKERS (RUT, NOMBRES, APELLIDOS)
					VALUES (@RUT_PROPIETARIO, @NOM_DUENO, @APELLIDO_DUENO)
				END
		END
	ELSE IF(@TIPO_PROPIETARIO = 'E')
		BEGIN
			IF(NOT EXISTS(
							SELECT
								ACRONIMO
							FROM ENTERPRISE
							WHERE IDEMPRESA = @RUT_PROPIETARIO
						)
			)
				BEGIN
					INSERT INTO ENTERPRISE (IDEMPRESA, ACRONIMO)
					VALUES (@RUT_PROPIETARIO, @ACRONIMO_DUENO)
				END
		END

END
