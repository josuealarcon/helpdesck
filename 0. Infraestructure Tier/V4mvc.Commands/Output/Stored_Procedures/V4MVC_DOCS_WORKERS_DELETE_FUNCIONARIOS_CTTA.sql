CREATE PROCEDURE [dbo].[V4MVC_DOCS_WORKERS_DELETE_FUNCIONARIOS_CTTA]
(
  @DEL_ID_DOCW	UNIQUEIDENTIFIER
 ,@RUT			NVARCHAR(8) = ''
 ,@USUARIO		NVARCHAR(10) = ''
 ,@DIVCOD		NVARCHAR(4) = ''
 ,@IDEMPRESA	NVARCHAR(11) = ''
)
AS
BEGIN
	DECLARE @ID_DOC INT = 18 /*FINIQUITO*/

	IF(@DIVCOD IS NOT NULL AND @DIVCOD <> '')
		BEGIN
			DELETE
			FROM DOCS_WORKERS
			WHERE
				(RUT = @RUT) AND
				(ID_DOC = @ID_DOC) AND
				(DIVISION = @DIVCOD) AND
				(ID = @DEL_ID_DOCW)
		END
	ELSE
		BEGIN
			DELETE
			FROM DOCS_WORKERS
			WHERE
				(RUT = @RUT) AND
				(ID_DOC = @ID_DOC) AND
				(ID = @DEL_ID_DOCW)
		END

	IF(NOT EXISTS(
		SELECT
			RUT
		FROM DOCS_WORKERS
		WHERE (ID = @DEL_ID_DOCW)
		))
		BEGIN
			DELETE
			FROM ARCHIVOS
			WHERE ID = @DEL_ID_DOCW
		END

	INSERT INTO HIST_DOCS_WORK (USUARIO, ID_DOC, RUT, FECHA , HORA, ACCION)
	VALUES (@USUARIO, @ID_DOC, @RUT, dbo.hoy(getdate()), dbo.ahora(getdate()), 'DEL')
END
