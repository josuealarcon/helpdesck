CREATE PROCEDURE [dbo].[V4MVC_COLAB_USUARIO_VALIDARCLAVEHISTORICO_CTTA]
(
 @ID		NVARCHAR(10) = NULL
,@IDEMPRESA	NVARCHAR(10) = NULL
,@CLAVE		NVARCHAR(50) = NULL
)
AS
BEGIN

	IF NOT EXISTS(
			SELECT TOP 5 CLAVE 
			FROM	COLAB_USUARIO_HST 
			WHERE	RUT					= @ID
			AND		EMPRESA				= @IDEMPRESA
			AND		CLAVE  = SUBSTRING(master.dbo.fn_varbintohexstr(HashBytes('SHA1', convert(nvarchar(50),@CLAVE))), 3, 32)
			ORDER BY FECHAMOD DESC
			)
		BEGIN
				SELECT 1 AS RESPUESTA
			END
		ELSE
			BEGIN
				SELECT 0 AS RESPUESTA
			END

END
