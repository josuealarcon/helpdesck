CREATE PROCEDURE [dbo].[V4MVC_VIDEOS_UPSERT_VIDEOS_MDTE]
(
	@STR_ID				NVARCHAR(18) = NULL OUTPUT
   ,@NOMBRE_ARCHIVO		NVARCHAR(100)
   ,@TIPO_CONTENIDO		NVARCHAR(100)
   ,@USUARIO			NVARCHAR(10) 	
   ,@ARCHIVO			IMAGE
   ,@MODULO_V4			INT = NULL
   ,@VISTA_LINK			NVARCHAR(200)
   ,@VERSION			NVARCHAR(20)
   ,@DESCRIPCION		NVARCHAR(100)
   ,@PRIVADO			NVARCHAR(2)
) AS
BEGIN
	DECLARE @CURR_FECHA NVARCHAR(8) = convert(NVARCHAR(8), getdate(), 112) /* yyyymmdd */
	DECLARE @CURR_TIEMPOFULL NVARCHAR(8) = convert(NVARCHAR(8), getdate(), 108) /* hh:mm:ss */
	IF(NOT EXISTS(SELECT TOP 1 * FROM VIDEOS WHERE ID = CONVERT(NUMERIC(18,0), @STR_ID)))
		BEGIN
			INSERT INTO VIDEOS
					(
					 MODULO_V4,
					 VERSION,
					 DESCRIPCION,
					 ARCHIVO,
					 FECHA_MOD,
					 HORA_MOD,
					 USUARIO,
					 PRIVADO,
					 NOMBRE_ARCHIVO,
					 TIPO_CONTENIDO
					)
			VALUES (
			         @MODULO_V4,
					 @VERSION,
					 @DESCRIPCION,
					 @ARCHIVO,
					 @CURR_FECHA,
					 @CURR_TIEMPOFULL,
					 @USUARIO,
					 @PRIVADO,
					 @NOMBRE_ARCHIVO,
					 @TIPO_CONTENIDO
					)
			SET @STR_ID	= CONVERT(NVARCHAR(18), SCOPE_IDENTITY())
		END
	ELSE
		BEGIN
			UPDATE VIDEOS
			SET
				MODULO_V4 = @MODULO_V4,
				VERSION = @VERSION,
				DESCRIPCION = @DESCRIPCION,
				FECHA_MOD = @CURR_FECHA,
				HORA_MOD = @CURR_TIEMPOFULL,
				USUARIO = @USUARIO,
				PRIVADO = @PRIVADO,
				NOMBRE_ARCHIVO = @NOMBRE_ARCHIVO,
				TIPO_CONTENIDO = @TIPO_CONTENIDO
			WHERE ID = CONVERT(NUMERIC(18,0), @STR_ID)
		END

	
	IF(NOT EXISTS(SELECT TOP 1 * FROM LINKS_VIDEOS_V4 WHERE ID_VIDEO = CONVERT(INT, @STR_ID)))
		BEGIN
			INSERT INTO LINKS_VIDEOS_V4(LINK, ID_VIDEO) VALUES(@VISTA_LINK, CONVERT(INT, @STR_ID))
		END
	ELSE
		BEGIN
			UPDATE LINKS_VIDEOS_V4
			SET
				LINK = @VISTA_LINK
			WHERE ID_VIDEO = CONVERT(INT, @STR_ID)
		END

END
