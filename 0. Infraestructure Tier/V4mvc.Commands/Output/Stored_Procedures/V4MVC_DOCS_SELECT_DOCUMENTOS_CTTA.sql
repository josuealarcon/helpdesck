CREATE PROCEDURE [dbo].[V4MVC_DOCS_SELECT_DOCUMENTOS_CTTA]
(@DIVCOD			NVARCHAR(50) = NULL
,@ID_DOC_OPCION		INT = NULL) AS
BEGIN
	IF(@ID_DOC_OPCION = 0)
		BEGIN
			SELECT DISTINCT D.NOMBRE, 
							 D.ID_DOC, 
							 D.SUBEDOC, 
							 D.ORDEN, 
							 D.COMUN_DIV, 
							 D.COMUN ,
							 (CASE WHEN EXISTS(SELECT DT.TIPOPASE 
											FROM  DOCS_TIPOPASE AS DT 
											WHERE D.ID_DOC = DT.ID_DOC
											AND (DT.DIVISION = @DIVCOD)
											AND DT.TIPOPASE<>'OPCIONAL') THEN 'OBLIGATORIO' ELSE '' END) AS TIPOPASE ,
							 @DIVCOD AS DIVCOD,
                             ISNULL(AG.IDGRUPO, 0) AS IDGRUPO
			FROM  DOCS AS D 
			INNER JOIN DOCS_TIPOPASE AS DT ON D.ID_DOC = DT.ID_DOC 
			LEFT JOIN DOCS_AGRUPACION AG ON D.ID_DOC = AG.ID_DOC 
			LEFT JOIN DOCS_GRUPOS G ON AG.IDGRUPO = G.ID AND G.DIVISION = @DIVCOD AND G.TIPO = 'FUNCIONARIO' 
			WHERE (D.ACTIVO = 'SI') 
			AND (D.ID_DOC_OPCION IN (0)) 
			AND (DT.DIVISION = @DIVCOD) 
			AND (D.ID_TIPO_PROPIETARIO = 1) 
			AND (D.ID_DOC NOT IN (SELECT ISNULL(Valor1,'-1') AS Valor1 
								FROM PARAMETROS_V2 
								WHERE Descripcion = 'Certificacion Funcionarios'))
			ORDER BY D.ORDEN
		END
	ELSE
		BEGIN
			SELECT DISTINCT D.NOMBRE, 
							 D.ID_DOC, 
							 D.SUBEDOC, 
							 D.ORDEN, 
							 D.COMUN_DIV, 
							 D.COMUN ,
							 (CASE WHEN EXISTS(SELECT DT.TIPOPASE 
											FROM  DOCS_TIPOPASE AS DT 
											WHERE D.ID_DOC = DT.ID_DOC
											AND (DT.DIVISION = @DIVCOD)
											AND DT.TIPOPASE<>'OPCIONAL') THEN 'OBLIGATORIO' ELSE '' END) AS TIPOPASE ,
							 @DIVCOD AS DIVCOD,
							 ISNULL(AG.IDGRUPO, 0) AS IDGRUPO					  
			FROM  DOCS AS D 
			INNER JOIN DOCS_TIPOPASE AS DT ON D.ID_DOC = DT.ID_DOC 
			LEFT JOIN DOCS_AGRUPACION AG ON D.ID_DOC = AG.ID_DOC 
			LEFT JOIN DOCS_GRUPOS G ON AG.IDGRUPO = G.ID AND G.DIVISION = @DIVCOD AND G.TIPO = 'FUNCIONARIO' 
			WHERE (D.ACTIVO = 'SI') 
			AND (D.ID_DOC_OPCION IN (1)) 
			AND (DT.DIVISION = @DIVCOD) 
			AND (D.ID_TIPO_PROPIETARIO = 1) 
			ORDER BY D.ORDEN
		END
END


