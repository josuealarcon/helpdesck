CREATE PROCEDURE [dbo].[V4MVC_OST_DOC_FEC_VARIOS]   
(@IDEMPRESA            NVARCHAR(10) = NULL) AS           
BEGIN    
  
	CREATE TABLE #DOCS (              
	DESCRIPCION_DOC VARCHAR(20)	 COLLATE DATABASE_DEFAULT NOT NULL,            
	CANTIDAD_DOC INT,                     
	)           
  
	INSERT INTO #DOCS  
	SELECT 'VIGENTES' ,SUM(CASE WHEN GETDATE() BETWEEN FINICIO AND FTERMINO THEN 1 ELSE 0 END)  
	FROM OSTARBOL   
	WHERE EMPRESA = @IDEMPRESA OR MADRE = @IDEMPRESA  
  
	INSERT INTO #DOCS  
	SELECT 'VENCIDAS' ,SUM(CASE WHEN GETDATE() NOT BETWEEN FINICIO AND FTERMINO THEN 1 ELSE 0 END)  
	FROM OSTARBOL   
	WHERE EMPRESA = @IDEMPRESA OR MADRE = @IDEMPRESA  
  
	INSERT INTO #DOCS  
	SELECT 'CANTOST' ,COUNT(OST)    
	FROM OSTARBOL   
	WHERE (EMPRESA = @IDEMPRESA OR MADRE = @IDEMPRESA) AND FTERMINO <= DATEADD(d,30,GETDATE()) AND FTERMINO >= GETDATE()  
  
	INSERT INTO #DOCS  
	SELECT 'CANTVEH' ,COUNT(DISTINCT PATENTE)   
	FROM V_DOCS_FEC_VEH   
	WHERE EMPRESA = @IDEMPRESA AND FECHA >= GETDATE() AND FECHA <= DATEADD(d,30,GETDATE())  
  
	INSERT INTO #DOCS  
	SELECT 'CANTWORK',COUNT(DISTINCT RUT)  
	FROM V_DOCS_FEC_WORK   
	WHERE EMPRESA = @IDEMPRESA AND FECHA >= CONVERT(VARCHAR(8),GETDATE(),112) AND FECHA <= CONVERT(VARCHAR(8),DATEADD(d,30,GETDATE()),112)  
  
	SELECT CANTIDAD_DOC,DESCRIPCION_DOC FROM #DOCS  
  
END
