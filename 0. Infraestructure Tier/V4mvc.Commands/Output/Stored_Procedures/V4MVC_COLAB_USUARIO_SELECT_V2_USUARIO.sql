CREATE PROCEDURE [dbo].[V4MVC_COLAB_USUARIO_SELECT_V2_USUARIO]  
(
  @IdEmpresa   NVARCHAR(10) = NULL  
 ,@Rut         NVARCHAR(10) = NULL
) AS  
BEGIN  
  
	SELECT
		COALESCE(CU.IdEmpresa, W.EMPRESA) AS IdEmpresa,
		COALESCE(CU.Rut, W.RUT) AS Rut,
		CU.Clave,
		CU.Correo_Electronico,
		CU.TipoUsuario,
		CU.Activo,
		CU.EnvioAlertas,
		CU.Fecha_Creacion,
		CU.Fecha_Modificacion,
		CU.Ultimo_Acceso,
		CU.FechaVence,
		W.NOMBRES,
		W.APELLIDOS,
		COALESCE(E.IDEMPRESA, W.EMPRESA) AS IDEMPRESA,
		COALESCE(E.ACRONIMO, (SELECT TOP 1 E2.ACRONIMO FROM ENTERPRISE E2 WHERE E2.IDEMPRESA = @IdEmpresa)) AS ACRONIMO,
		COALESCE(E.NOMBRE, (SELECT TOP 1 E3.NOMBRE FROM ENTERPRISE E3 WHERE E3.IDEMPRESA = @IdEmpresa)) AS NOMBRE
	FROM  WORKERS W
	LEFT JOIN COLAB_USUARIO CU
		ON W.RUT = CU.Rut
	LEFT JOIN ENTERPRISE E
		ON CU.IdEmpresa = E.IDEMPRESA
	WHERE
		W.EMPRESA = @IdEmpresa AND
		W.RUT = @Rut 
  
END 
