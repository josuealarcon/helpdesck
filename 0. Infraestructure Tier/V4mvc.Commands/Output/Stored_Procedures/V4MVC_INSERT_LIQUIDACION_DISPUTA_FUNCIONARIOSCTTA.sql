CREATE PROCEDURE [dbo].[V4MVC_INSERT_LIQUIDACION_DISPUTA_FUNCIONARIOSCTTA]
(@RUT		    NVARCHAR(10) = NULL 
,@PERIODO		NVARCHAR(6) = NULL 
,@EMPRESA	    NVARCHAR(10) = NULL 
,@OBSERVACION	NVARCHAR(1000) = NULL
,@USUARIO	NVARCHAR(10) = NULL) AS
BEGIN

INSERT INTO LIQUIDACION_DISPUTA(RUT,  PERIODO,  EMPRESA, OBSERVACION,  USUARIO,  FECHA,                HORA,                     ID, CERTUSUARIO, CERTFECHA, CERTHORA, ESTADO, VALIDADO)
                        SELECT  RUT,  @PERIODO, EMPRESA, @OBSERVACION, @USUARIO, [dbo].[hoy](GETDATE()),[dbo].[ahora](GETDATE()),ID, CERTUSUARIO, CERTFECHA, CERTHORA, 'NO',    VALIDADO
						FROM LIQUIDACION WHERE RUT = @RUT AND FECHA = @PERIODO  AND EMPRESA = @EMPRESA

	SELECT TOP 1 ESTADO, ID_DISPUTA,OBSERVACION,OBSERVACION_REVAL 
	FROM LIQUIDACION_DISPUTA 
	WHERE RUT = @RUT AND PERIODO = @PERIODO AND EMPRESA = @EMPRESA AND ESTADO <> 'SI' ORDER BY ID_DISPUTA DESC
END
