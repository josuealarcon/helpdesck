CREATE PROCEDURE [dbo].[V4MVC_REMULOGPROCESO_SELECT_INFORME_DOCUMENTOSCARGADOSAUDITORIALABORALMENSUAL_DETALLE_INFORME_CONTROLLABAROAL_CTTA]
(
@PERIODO  NVARCHAR(6)       = NULL,
@EMPRESA  NVARCHAR(10)       = NULL
) AS
BEGIN

DECLARE @strSQL as nvarchar(MAX)

 SET @strSQL='SELECT 
 COUNT(R.RUT) OVER() TOTALREGISTROS
,ROW_NUMBER() OVER(ORDER BY R.PAIS, R.EMPRESA, R.RUT) ROWNUMBER
,R.PAIS
,R.RUT
,R.OST
,R.EMPRESA
,R.TIPOCONTRATO
,R.FPROCESO
,R.PREVIRED
,R.L_SUELDO
,R.PBANCO
,R.CUMPLE
,R.P_CUMPLE
,R.IMPONIBLE_P
,R.IMPONIBLE_L
,R.LIQUIDO
,R.TRANSFERIDO
,R.FINIQUITO
,R.VALIDADO
,R.BONOIP
,R.DIFBONOIS
,R.BONOIS 
,(SELECT NOMBRES FROM WORKERS WHERE RUT= R.RUT) AS NOMBRES
,(SELECT APELLIDOS FROM WORKERS WHERE RUT= R.RUT) AS APELLIDOS
 FROM REMULOGPROCESO R WHERE PERIODO= ''' + @PERIODO + ''''

	IF @EMPRESA <> '' OR @EMPRESA <> NULL
	BEGIN
		Set @strSQL = @strSQL + N' AND EMPRESA = ''' + @EMPRESA + ''''
	END			           

	exec sp_executesql @strSQL  
	PRINT @strSQL
 
END	
