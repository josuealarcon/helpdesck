CREATE PROCEDURE [dbo].[V4MVC_WORKERSLOCAL_SELECT_LABORALES_CTTA] 
( @RUT                nvarchar(10) = NULL
, @EMPRESA            nvarchar(50) = NULL) AS 
BEGIN
	SELECT W.RUT		, W.TIPOPASE , D.DIVISION	, D.DIVCOD
		 , W.FINIPASE	, W.FFINPASE , W.QUIEN		, W.LOTE	
		 , W.OST		, W.AUTOR	 , W.EMPRESA	, E.ACRONIMO
		 , CASE WHEN (SELECT [dbo].[fn_WL_Certificado] (@RUT , W.EMPRESA , W.TIPOPASE, D.DIVCOD ,[dbo].[hoy](GETDATE()))) = 1 THEN 'true' ELSE 'false' END AS CERTFUN
	FROM WORKERSLOCAL AS W, A024_DIVISIONES AS D , ENTERPRISE AS E
	WHERE (D.DIVCOD = W.DIVISION) 
	AND (W.RUT = @RUT) 
	AND (W.EMPRESA = @EMPRESA)  
	AND (E.IDEMPRESA = W.EMPRESA)
	AND (dbo.hoy(GETDATE()) BETWEEN W.FINIPASE AND W.FFINPASE) ORDER BY W.LOTE
END

