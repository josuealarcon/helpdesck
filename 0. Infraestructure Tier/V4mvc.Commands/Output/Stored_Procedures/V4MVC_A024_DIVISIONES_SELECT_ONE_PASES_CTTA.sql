CREATE PROCEDURE [dbo].[V4MVC_A024_DIVISIONES_SELECT_ONE_PASES_CTTA]
(
  @OST			NVARCHAR(14)
 ,@DIVCOD		NVARCHAR(4)
 ,@IDEMPRESA	NVARCHAR(10)
 ,@M_APR		BIT OUTPUT
 ,@M_ARRANQUE	BIT OUTPUT
 ,@OK			BIT OUTPUT
) AS
BEGIN
	DECLARE @CONTROL_SEGURIDAD NVARCHAR(2) = ''
	DECLARE @ESTADO NVARCHAR(2) = ''
	DECLARE @VALIDA_CARRANQUE NVARCHAR(2) = ''
	
	SET @M_APR = 0
	SET @M_ARRANQUE = 0
	SET @OK = 1

	SELECT
		@CONTROL_SEGURIDAD = ISNULL(CONTROL_SEGURIDAD, 'NO')
	FROM A024_DIVISIONES
	WHERE DIVCOD = @DIVCOD
	
	IF(@CONTROL_SEGURIDAD <> '')
		BEGIN
			IF(@CONTROL_SEGURIDAD = 'SI')
				BEGIN
					SELECT
						@ESTADO = ISNULL(ESTADO, 'NO')
					FROM DOCS_OST_PREVENCIONISTA
					WHERE OST = @OST

					IF(@ESTADO <> '')
						BEGIN
							IF(@ESTADO <> 'SI')
								BEGIN
									SET @M_APR = 1
								END
						END
					ELSE
						BEGIN
							SET @M_APR = 1
						END

					SELECT
						@VALIDA_CARRANQUE = ISNULL(VALIDA_CARRANQUE,'NO')
					FROM OSTARBOL
					WHERE EMPRESA = @IDEMPRESA AND OST = @OST

					IF(@VALIDA_CARRANQUE <> '')
						BEGIN
							IF(@VALIDA_CARRANQUE <> 'SI')
								BEGIN
									SET @M_ARRANQUE = 1
								END
						END
					ELSE
						BEGIN
							SET @M_ARRANQUE = 1
						END
				END
		END
	
	IF(@M_APR = 1 OR @M_ARRANQUE = 1)
		BEGIN
			SET @OK = 0
		END
END

