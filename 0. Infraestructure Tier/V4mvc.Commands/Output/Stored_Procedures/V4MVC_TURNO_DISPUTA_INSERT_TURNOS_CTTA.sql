CREATE PROCEDURE [dbo].[V4MVC_TURNO_DISPUTA_INSERT_TURNOS_CTTA]
( @IDTURNO INT = NULL 
, @OBSERVACION NVARCHAR(1000) = NULL 
, @USUARIO NVARCHAR(20) = NULL 
, @ID_DISPUTA INT  = NULL OUTPUT 
) AS 
BEGIN

	DECLARE @ID UNIQUEIDENTIFIER = NULL
	DECLARE @TURNO NVARCHAR(20) = ''
	DECLARE @EMPRESA NVARCHAR(10) = ''    
	DECLARE @CURR_FECHA NVARCHAR(8) =  [dbo].[hoy](GETDATE()) 
	DECLARE @CURR_TIEMPOFULL NVARCHAR(8) = [dbo].[ahora](GETDATE())
	DECLARE @CERTUSUARIO NVARCHAR(20) = ''
	DECLARE @CERTFECHA NVARCHAR(8) = ''
	DECLARE @CERTHORA NVARCHAR(8) = ''
	DECLARE @OBS_RECHAZO NVARCHAR(MAX) = ''
	DECLARE @ESTADO NVARCHAR(2) = 'NO'
	DECLARE @VALIDADO NVARCHAR(2) = ''

	SELECT 
		@ID = ID,
		@TURNO = TURNO,
		@EMPRESA = EMPRESA,
		@CERTUSUARIO = CERTUSUARIO,
		@CERTFECHA = CERTFECHA,
		@CERTHORA = CERTHORA,
		@VALIDADO = VALIDADO,
		@OBS_RECHAZO = OBS_RECHAZO
	FROM TURNOS
	WHERE IDTURNO = @IDTURNO

	INSERT INTO [dbo].[TURNOS_DISPUTA]
           ([IDTURNO]		, [ID]			, [TURNO]	 , [EMPRESA]
           ,[OBSERVACION]	, [USUARIO]		, [FECHA]	 , [HORA]
           ,[CERTUSUARIO]	, [CERTFECHA]	, [CERTHORA] , [OBS_RECHAZO]
		   ,[ESTADO]		, [VALIDADO])
    VALUES
           (@IDTURNO		, @ID			, @TURNO	  , @EMPRESA
           ,@OBSERVACION	, @USUARIO		, @CURR_FECHA , @CURR_TIEMPOFULL
		   ,@CERTUSUARIO	, @CERTFECHA	, @CERTHORA   , @OBS_RECHAZO
		   ,@ESTADO			, @VALIDADO	)

	SET @ID_DISPUTA = SCOPE_IDENTITY()
END
/****** Object:  StoredProcedure [dbo].[V4MVC_TURNOS_SELECT_EDIT_TURNOS_CTTA]    Script Date: 1/11/2020 16:20:53 ******/
SET ANSI_NULLS ON
